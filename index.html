<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suíte Criativa: Voz, Imagem e Vídeo</title>
    <!-- LINHA ADICIONADA: Conecta o "Cartão de Identidade" do app -->
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/lamejs@1.2.1/lame.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        .mini-loader {
            width: 20px;
            height: 20px;
            border-width: 2px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .tab-btn.active {
            border-color: #3b82f6;
            color: #3b82f6;
            background-color: #eff6ff;
        }
        .image-thumbnail {
            position: relative;
        }
        .image-thumbnail img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 0.5rem;
            border: 2px solid #e5e7eb;
        }
        .remove-img-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            background-color: #ef4444;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            border: 1px solid white;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen py-10">
    <div class="w-full max-w-2xl mx-auto bg-white rounded-2xl shadow-lg p-6 md:p-8">
        
        <!-- Navegação por Abas -->
        <div class="mb-6 border-b border-gray-200">
            <nav class="-mb-px flex space-x-4" aria-label="Tabs">
                <button id="tab-tts" class="tab-btn active whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm">Texto para Voz</button>
                <button id="tab-image" class="tab-btn whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">Gerador de Imagens</button>
                <button id="tab-video" class="tab-btn whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">Criador de Vídeo</button>
            </nav>
        </div>

        <!-- Conteúdo das Abas -->
        <main>
            <!-- ABA: TEXTO PARA VOZ -->
            <div id="content-tts" class="tab-content">
                <header class="text-center mb-6"><h1 class="text-3xl md:text-4xl font-bold text-gray-800">Texto para Voz</h1><p class="text-gray-500 mt-2">Digite seu texto, escolha uma voz e ouça a magia acontecer.</p></header>
                <div class="mb-4"><label for="text-input" class="block text-sm font-medium text-gray-700 mb-2">Seu texto:</label><textarea id="text-input" rows="6" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Escreva algo aqui..."></textarea></div>
                <div class="mb-6"><label for="voice-select" class="block text-sm font-medium text-gray-700 mb-2">Escolha uma voz:</label><div class="flex items-center space-x-3"><select id="voice-select" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></select><button id="preview-btn" class="bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-lg hover:bg-gray-300" style="min-width: 120px;"><span id="preview-btn-text">Ouvir Prévia</span><div id="preview-loader" class="hidden loader mini-loader"></div></button></div></div>
                <button id="generate-btn" class="w-full bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-blue-700">Gerar Áudio</button>
                <div id="tts-loader" class="hidden mx-auto mt-6 loader"></div>
                <div id="audio-container" class="mt-6 hidden"><p class="text-sm font-medium text-gray-700 mb-2 text-center">Resultado:</p><audio id="audio-player" controls class="w-full"></audio><audio id="preview-player" class="hidden"></audio></div>
                <div id="tts-error-message" class="hidden mt-4 p-3 bg-red-100 text-red-700 rounded-lg text-center"></div>
                <div id="history-section" class="mt-8 pt-6 border-t border-gray-200 hidden"><h2 class="text-xl font-semibold text-gray-700 mb-4 text-center">Histórico de Áudios</h2><ul id="history-list" class="space-y-3"></ul></div>
            </div>

            <!-- ABA: GERADOR DE IMAGENS -->
            <div id="content-image" class="tab-content hidden">
                 <header class="text-center mb-6"><h1 class="text-3xl md:text-4xl font-bold text-gray-800">Gerador de Imagens</h1><p class="text-gray-500 mt-2">Descreva a imagem que você quer criar.</p></header>
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <label for="image-prompt" class="block text-sm font-medium text-gray-700">Sua ideia:</label>
                        <button id="enhance-prompt-btn" class="text-sm text-purple-600 font-semibold hover:text-purple-800 flex items-center">
                            <span class="mr-1">✨</span> Me Ajude a Criar
                        </button>
                    </div>
                    <textarea id="image-prompt" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="Ex: Um astronauta surfando em um anel de Saturno, arte digital"></textarea>
                </div>
                <button id="generate-image-btn" class="w-full bg-purple-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-purple-700">Gerar Imagem</button>
                <div id="image-loader" class="hidden mx-auto mt-6 loader"></div>
                <div id="image-container" class="mt-6 hidden w-full aspect-square bg-gray-100 rounded-lg overflow-hidden"><img id="generated-image" src="" alt="Imagem Gerada" class="w-full h-full object-contain"></div>
                <div id="image-actions" class="hidden mt-4 flex items-center space-x-3"><a id="download-image-btn" href="#" download="imagem-gerada.png" class="flex-1 text-center bg-green-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-700">Salvar Imagem</a><button id="add-to-video-btn" class="flex-1 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700">Adicionar ao Vídeo</button></div>
                <div id="image-error-message" class="hidden mt-4 p-3 bg-red-100 text-red-700 rounded-lg text-center"></div>
            </div>

            <!-- ABA: CRIADOR DE VÍDEO -->
            <div id="content-video" class="tab-content hidden">
                 <header class="text-center mb-6"><h1 class="text-3xl md:text-4xl font-bold text-gray-800">Criador de Vídeo</h1><p class="text-gray-500 mt-2">Crie um vídeo a partir de imagens e narração.</p></header>
                <div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">Imagens para o vídeo:</label><div id="video-images-container" class="p-4 border-2 border-dashed border-gray-300 rounded-lg min-h-[120px] flex items-center justify-start flex-wrap gap-3"></div></div>
                <div class="mb-4">
                    <label for="narration-theme" class="block text-sm font-medium text-gray-700 mb-2">Tema do Vídeo (para gerar roteiro):</label>
                    <input type="text" id="narration-theme" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="Ex: Uma jornada por uma floresta mágica">
                </div>
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <label for="narration-script" class="block text-sm font-medium text-gray-700">Roteiro da Narração:</label>
                        <button id="generate-script-btn" class="text-sm text-green-600 font-semibold hover:text-green-800 flex items-center">
                           <span class="mr-1">✨</span> Gerar Roteiro
                        </button>
                    </div>
                    <textarea id="narration-script" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="Escreva o que a voz deve dizer no vídeo..."></textarea>
                </div>
                <button id="generate-video-btn" class="w-full bg-green-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-green-700 disabled:bg-gray-400" disabled>Gerar Vídeo</button>
                <p class="text-xs text-center text-gray-400 mt-2">(Funcionalidade de geração de vídeo em desenvolvimento)</p>
            </div>
        </main>
    </div>

    <script>
        // --- DECLARAÇÃO DE CONSTANTES DA UI ---
        // Estado Global
        let videoAssets = { images: [], narrationUrl: null, script: '' };
        
        // Abas
        const tabs = [
            { btn: document.getElementById('tab-tts'), content: document.getElementById('content-tts') },
            { btn: document.getElementById('tab-image'), content: document.getElementById('content-image') },
            { btn: document.getElementById('tab-video'), content: document.getElementById('content-video') }
        ];

        // TTS
        const textInput = document.getElementById('text-input'), voiceSelect = document.getElementById('voice-select'), generateBtn = document.getElementById('generate-btn'), previewBtn = document.getElementById('preview-btn'), previewBtnText = document.getElementById('preview-btn-text'), previewLoader = document.getElementById('preview-loader'), ttsLoader = document.getElementById('tts-loader'), audioContainer = document.getElementById('audio-container'), audioPlayer = document.getElementById('audio-player'), previewPlayer = document.getElementById('preview-player'), ttsErrorMessage = document.getElementById('tts-error-message'), historySection = document.getElementById('history-section'), historyList = document.getElementById('history-list');
        let audioHistory = [];
        const voices = [ { name: "Zephyr (Clara e Amigável)", id: "Zephyr" }, { name: "Puck (Animada e Jovem)", id: "Puck" }, { name: "Charon (Informativa e Calma)", id: "Charon" }, { name: "Kore (Firme e Direta)", id: "Kore" }, { name: "Fenrir (Energética e Entusiasmada)", id: "Fenrir" }, { name: "Leda (Suave e Juvenil)", id: "Leda" }, { name: "Orus (Grave e Sólida)", id: "Orus" }, { name: "Aoede (Leve e Descontraída)", id: "Aoede" }, { name: "Sadachbia (Vivaz e Dinâmica)", id: "Sadachbia" }, { name: "Sulafat (Acolhedora e Quente)", id: "Sulafat" }];

        // Gerador de Imagem
        const imagePrompt = document.getElementById('image-prompt'), generateImageBtn = document.getElementById('generate-image-btn'), imageLoader = document.getElementById('image-loader'), imageContainer = document.getElementById('image-container'), generatedImage = document.getElementById('generated-image'), imageErrorMessage = document.getElementById('image-error-message'), imageActions = document.getElementById('image-actions'), downloadImageBtn = document.getElementById('download-image-btn'), addToVideoBtn = document.getElementById('add-to-video-btn'), enhancePromptBtn = document.getElementById('enhance-prompt-btn');

        // Criador de Vídeo
        const videoImagesContainer = document.getElementById('video-images-container'), narrationScript = document.getElementById('narration-script'), generateVideoBtn = document.getElementById('generate-video-btn'), narrationTheme = document.getElementById('narration-theme'), generateScriptBtn = document.getElementById('generate-script-btn');

        // --- LÓGICA DAS ABAS ---
        tabs.forEach(tab => {
            tab.btn.addEventListener('click', () => {
                tabs.forEach(t => { t.btn.classList.remove('active'); t.content.classList.add('hidden'); });
                tab.btn.classList.add('active');
                tab.content.classList.remove('hidden');
            });
        });

        // --- FUNÇÃO GENÉRICA PARA API DE TEXTO ---
        async function generateTextAPI(prompt) {
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
            let attempts = 0, maxAttempts = 5, delay = 1000;
            while (attempts < maxAttempts) {
                try {
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (response.ok) {
                        const result = await response.json();
                        const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                        if (text) return text;
                        throw new Error("Resposta da API de texto inválida.");
                    } else {
                        const errorBody = await response.text();
                        console.error("Corpo do erro da API de Texto:", errorBody);
                        throw new Error(`Erro na API de Texto: ${response.status}`);
                    }
                } catch (e) {
                    attempts++;
                    if (attempts >= maxAttempts) throw e;
                    await new Promise(res => setTimeout(res, delay));
                    delay *= 2;
                }
            }
            throw new Error("Falha na API de texto após várias tentativas.");
        }

        // --- LÓGICA DO TEXTO PARA VOZ (TTS) ---
        function populateVoices() { voices.forEach(v => { const o = document.createElement('option'); o.value = v.id; o.textContent = v.name; voiceSelect.appendChild(o); }); }
        generateBtn.addEventListener('click', handleGenerateAudio);
        previewBtn.addEventListener('click', handlePreview);
        async function handleGenerateAudio() {
            const text = textInput.value.trim();
            if (!text) { showErrorTTS("Por favor, digite algum texto."); return; }
            const selectedVoice = voices.find(v => v.id === voiceSelect.value);
            resetUITTS(); ttsLoader.classList.remove('hidden'); generateBtn.disabled = true; previewBtn.disabled = true; generateBtn.textContent = 'Gerando Áudio...';
            try {
                const audioData = await generateTTSAPI(text, selectedVoice.id), sampleRate = 24000, pcm16 = new Int16Array(base64ToArrayBuffer(audioData)), wavBlob = pcmToWav(pcm16, sampleRate), audioUrl = URL.createObjectURL(wavBlob);
                audioPlayer.src = audioUrl; audioContainer.classList.remove('hidden'); generateBtn.textContent = 'Codificando MP3...';
                const mp3Blob = pcmToMp3(pcm16, sampleRate), mp3Url = URL.createObjectURL(mp3Blob), timestamp = Date.now();
                addToHistory({ text, voiceName: selectedVoice.name, audioUrl, wavUrl: audioUrl, mp3Url, wavFileName: `audio_${timestamp}.wav`, mp3FileName: `audio_${timestamp}.mp3` });
            } catch (error) { console.error("Erro TTS:", error); showErrorTTS("Não foi possível gerar o áudio. Verifique sua conexão e tente novamente."); } finally { ttsLoader.classList.add('hidden'); generateBtn.disabled = false; previewBtn.disabled = false; generateBtn.textContent = 'Gerar Áudio'; }
        }
        async function handlePreview() {
            const voiceId = voiceSelect.value;
            previewBtn.disabled = true; generateBtn.disabled = true; previewBtnText.classList.add('hidden'); previewLoader.classList.remove('hidden'); resetUITTS();
            try {
                const audioData = await generateTTSAPI("Olá, esta é uma demonstração da minha voz.", voiceId), pcm16 = new Int16Array(base64ToArrayBuffer(audioData)), wavBlob = pcmToWav(pcm16, 24000);
                previewPlayer.src = URL.createObjectURL(wavBlob); previewPlayer.play();
            } catch (error) { console.error("Erro na Prévia:", error); showErrorTTS("Não foi possível gerar a prévia."); } finally { previewBtn.disabled = false; generateBtn.disabled = false; previewBtnText.classList.remove('hidden'); previewLoader.classList.add('hidden'); }
        }
        function addToHistory(item) { audioHistory.unshift(item); updateHistoryList(); }
        function updateHistoryList() {
            historyList.innerHTML = ''; if (audioHistory.length > 0) historySection.classList.remove('hidden');
            audioHistory.forEach(item => {
                const li = document.createElement('li');
                li.className = 'p-4 bg-gray-50 rounded-lg flex flex-col sm:flex-row sm:items-center sm:justify-between';
                li.innerHTML = `<div class="mb-3 sm:mb-0 mr-4"><p class="font-semibold text-gray-800 break-words">"${item.text.substring(0, 30)}${item.text.length > 30 ? '...' : ''}"</p><p class="text-sm text-gray-500">Voz: ${item.voiceName}</p></div><div class="flex items-center space-x-2 flex-shrink-0"><button class="play-history-btn bg-blue-100 text-blue-700 px-2 py-1.5 text-sm font-medium rounded-md hover:bg-blue-200">Ouvir</button><button class="use-in-video-btn bg-green-100 text-green-700 px-2 py-1.5 text-sm font-medium rounded-md hover:bg-green-200">Usar no Vídeo</button><a href="${item.mp3Url}" download="${item.mp3FileName}" class="bg-purple-100 text-purple-700 px-2 py-1.5 text-sm font-medium rounded-md hover:bg-purple-200">MP3</a></div>`;
                li.querySelector('.play-history-btn').addEventListener('click', () => { audioPlayer.src = item.audioUrl; audioPlayer.play(); });
                li.querySelector('.use-in-video-btn').addEventListener('click', () => { videoAssets.narrationUrl = item.audioUrl; videoAssets.script = item.text; updateVideoCreatorUI(); tabs[2].btn.click(); });
                historyList.appendChild(li);
            });
        }
        async function generateTTSAPI(text, voiceId) { const apiKey = ""; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`; const payload = { contents: [{ parts: [{ text: text }] }], generationConfig: { responseModalities: ["AUDIO"], speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: voiceId } } } } }; let a = 0, m = 5, d = 1000; while (a < m) { try { const r = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }); if (r.ok) { const j = await r.json(); const ad = j?.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data; if (ad) return ad; throw new Error("Resposta da API inválida."); } else { const e = await r.text(); console.error("Corpo do erro da API:", e); throw new Error(`Erro na API de TTS: ${r.status}`); } } catch (e) { a++; if (a >= m) throw e; await new Promise(res => setTimeout(res, d)); d *= 2; } } throw new Error("Falha na API de TTS após várias tentativas."); }
        function base64ToArrayBuffer(b64) { const s = window.atob(b64), l = s.length, b = new Uint8Array(l); for (let i = 0; i < l; i++) b[i] = s.charCodeAt(i); return b.buffer; }
        function pcmToWav(pcm, sr) { const ds = pcm.length * 2, b = new ArrayBuffer(44 + ds), v = new DataView(b); writeString(v, 0, 'RIFF'); v.setUint32(4, 36 + ds, true); writeString(v, 8, 'WAVE'); writeString(v, 12, 'fmt '); v.setUint32(16, 16, true); v.setUint16(20, 1, true); v.setUint16(22, 1, true); v.setUint32(24, sr, true); v.setUint32(28, sr * 2, true); v.setUint16(32, 2, true); v.setUint16(34, 16, true); writeString(v, 36, 'data'); v.setUint32(40, ds, true); for (let i = 0; i < pcm.length; i++) v.setInt16(44 + i * 2, pcm[i], true); return new Blob([v], { type: 'audio/wav' }); }
        function pcmToMp3(pcm, sr) { const enc = new lamejs.Mp3Encoder(1, sr, 128), s = pcm, sBS = 1152, mp3 = []; for (let i = 0; i < s.length; i += sBS) { const sc = s.subarray(i, i + sBS), buf = enc.encodeBuffer(sc); if (buf.length > 0) mp3.push(buf); } const end = enc.flush(); if (end.length > 0) mp3.push(end); return new Blob(mp3, { type: 'audio/mpeg' }); }
        function writeString(v, o, s) { for (let i = 0; i < s.length; i++) v.setUint8(o + i, s.charCodeAt(i)); }
        function showErrorTTS(m) { ttsErrorMessage.textContent = m; ttsErrorMessage.classList.remove('hidden'); }
        function resetUITTS() { ttsErrorMessage.classList.add('hidden'); }

        // --- LÓGICA DO GERADOR DE IMAGENS ---
        generateImageBtn.addEventListener('click', handleGenerateImage);
        addToVideoBtn.addEventListener('click', () => { videoAssets.images.push(generatedImage.src); updateVideoCreatorUI(); tabs[2].btn.click(); });
        enhancePromptBtn.addEventListener('click', handleEnhancePrompt);
        async function handleEnhancePrompt() {
            const simplePrompt = imagePrompt.value.trim();
            if (!simplePrompt) { showErrorImage("Digite uma ideia simples primeiro."); return; }
            const originalBtnText = enhancePromptBtn.innerHTML;
            enhancePromptBtn.innerHTML = `<div class="loader mini-loader mx-auto"></div>`;
            enhancePromptBtn.disabled = true;
            try {
                const fullPrompt = `Transforme a seguinte ideia em um prompt detalhado para um gerador de imagens de IA, descrevendo cena, estilo de arte, iluminação e composição: "${simplePrompt}"`;
                const enhancedPrompt = await generateTextAPI(fullPrompt);
                imagePrompt.value = enhancedPrompt.replace(/"/g, '');
            } catch (error) { console.error("Erro ao melhorar prompt:", error); showErrorImage("Não foi possível melhorar a ideia."); } finally { enhancePromptBtn.innerHTML = originalBtnText; enhancePromptBtn.disabled = false; }
        }
        async function handleGenerateImage() {
            const prompt = imagePrompt.value.trim();
            if (!prompt) { showErrorImage("Por favor, descreva a imagem."); return; }
            resetUIImage(); imageLoader.classList.remove('hidden'); generateImageBtn.disabled = true; generateImageBtn.textContent = 'Criando Magia...';
            try {
                const imageUrl = await generateImageAPI(prompt);
                generatedImage.src = imageUrl; downloadImageBtn.href = imageUrl;
                imageContainer.classList.remove('hidden'); imageActions.classList.remove('hidden');
            } catch (error) { console.error("Erro Imagem:", error); showErrorImage("Não foi possível criar a imagem."); } finally { imageLoader.classList.add('hidden'); generateImageBtn.disabled = false; generateImageBtn.textContent = 'Gerar Imagem'; }
        }
        async function generateImageAPI(prompt) { const apiKey = ""; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`; const payload = { instances: [{ prompt }], parameters: { "sampleCount": 1 } }; let a = 0, m = 5, d = 1000; while (a < m) { try { const r = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }); if (r.ok) { const j = await r.json(); if (j.predictions && j.predictions[0]?.bytesBase64Encoded) { return `data:image/png;base64,${j.predictions[0].bytesBase64Encoded}`; } throw new Error("API de imagem inválida."); } else { const e = await r.text(); console.error("Corpo do erro da API de Imagem:", e); throw new Error(`Erro API de imagem: ${r.status}`); } } catch (e) { if (a >= m - 1) throw e; await new Promise(res => setTimeout(res, d)); d *= 2; a++; } } throw new Error("Falha na API de imagem."); }
        function showErrorImage(m) { imageErrorMessage.textContent = m; imageErrorMessage.classList.remove('hidden'); }
        function resetUIImage() { imageErrorMessage.classList.add('hidden'); imageContainer.classList.add('hidden'); imageActions.classList.add('hidden'); generatedImage.src = ''; }

        // --- LÓGICA DO CRIADOR DE VÍDEO (UI) ---
        narrationScript.addEventListener('input', (e) => { videoAssets.script = e.target.value; updateVideoCreatorUI(); });
        generateScriptBtn.addEventListener('click', handleGenerateScript);
        async function handleGenerateScript() {
            const theme = narrationTheme.value.trim();
            if (!theme) { alert("Por favor, insira um tema para o vídeo."); return; }
            const originalBtnText = generateScriptBtn.innerHTML;
            generateScriptBtn.innerHTML = `<div class="loader mini-loader mx-auto"></div>`;
            generateScriptBtn.disabled = true;
            try {
                const prompt = `Crie um roteiro de narração curto e poético (3 a 4 frases) para um vídeo de slideshow sobre o tema: "${theme}"`;
                const script = await generateTextAPI(prompt);
                narrationScript.value = script.replace(/"/g, '');
                videoAssets.script = script;
                updateVideoCreatorUI();
            } catch (error) { console.error("Erro ao gerar roteiro:", error); alert("Não foi possível gerar o roteiro."); } finally { generateScriptBtn.innerHTML = originalBtnText; generateScriptBtn.disabled = false; }
        }
        function updateVideoCreatorUI() {
            videoImagesContainer.innerHTML = '';
            if (videoAssets.images.length === 0) { videoImagesContainer.innerHTML = `<p class="text-gray-400">Adicione imagens para começar.</p>`; } else {
                videoAssets.images.forEach((imgSrc, index) => {
                    const thumbDiv = document.createElement('div');
                    thumbDiv.className = 'image-thumbnail';
                    thumbDiv.innerHTML = `<img src="${imgSrc}" alt="Imagem ${index + 1}"><div class="remove-img-btn" data-index="${index}">X</div>`;
                    videoImagesContainer.appendChild(thumbDiv);
                });
                document.querySelectorAll('.remove-img-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => { const i = parseInt(e.target.dataset.index); videoAssets.images.splice(i, 1); updateVideoCreatorUI(); });
                });
            }
            narrationScript.value = videoAssets.script;
            generateVideoBtn.disabled = !(videoAssets.images.length > 0 && videoAssets.script.trim() !== '');
        }

        // --- INICIALIZAÇÃO DO APP ---
        // CORREÇÃO: Garante que o DOM está carregado antes de executar o script
        document.addEventListener('DOMContentLoaded', () => {
            populateVoices();
            updateVideoCreatorUI();

            // REGISTRO DO SERVICE WORKER
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    // CORREÇÃO: Caminho relativo para o service worker
                    navigator.serviceWorker.register('service-worker.js')
                        .then(reg => console.log('Service worker registrado:', reg))
                        .catch(err => console.log('Erro no registro do Service worker:', err));
                });
            }
        });
    </script>
</body>
</html>

 
